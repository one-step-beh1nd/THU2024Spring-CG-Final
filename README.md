# THU 2024 春 计算机图形学基础大作业
## 说在前面

本仓库的价值**不在代码，而在该README文件**

该仓库是贵系的一个菜鸡在被图形学折磨了一个星期后有感而发。

如果您是贵系大佬，请您移步其他仓库，因为本仓库可能并不能满足您的胃口。你并不能从该仓库中获得许多功能点的实现，甚至其中有的功能点至今仍有问题。

那我为什么要建立这个仓库呢？

图形学大作业之难度，讲解之匮乏，ppt之混乱，是我前所未见的。

本学期我有两个大作业：软工和图形学。这两个大作业都有着`讲解缺乏、上手困难`的问题。

软工给人的感觉是虽上手难，但熟练之后工作效率提高很多，“条条大路通罗马”，而且对查重要求很低；图形学给人的感觉是很难，而且路径十分有限，自己硬想一天不如别人点醒一句。

再加上课程ppt中对于参数定义十分繁杂且混乱，有时候看公式根本不知道对应什么东西，甚至能出现 `变量 + 常量`的公式（说的就是cook torrance）。

所以被折磨后，我希望能借此文件帮助同学`快速上手图形学作业`。我将在该文件中，`讲解我实现的功能点的实现路径`，防止出现看着学长的代码都不知道怎么抄的情况。

## 致谢与参考
在这里远程感谢以下代码对我写大作业的帮助：

[学长的代码](https://github.com/zhanglbthu/THU2023Spring-CG-FinalProject) 实现了

- whitted style光线追踪（疑似有bug）
- path tracing，不包括NEE、glossy材质
- 参数曲面求交（有明显的bug，可能他报告里的图不是他生成的）
- **OPENMP加速（不作为得分点，但可以大大减少渲染时间，从而更快出结果）**
- 光子映射（不再得分，因为太多人抄往年的这个算法）
- 纹理贴图
- 景深相机
- cos-weighted采样
- 抗锯齿（然而抗的效果并不好）
- 复杂三角网格（我没写，不敢保证他的一定对）
- 包围盒（同上）
- BVH树（同上）
- 法向插值（同上）


[smallpt](https://blog.csdn.net/g11d111/article/details/108189198) 请不要看99行的，去看二百多行的。其中包含

- path tracing，包括NEE，不包括glossy材质
- 抗锯齿（效果很好，但是时间耗费更多，约4倍）
- OPENMP加速
- cos-weighted采样

[基于cook-torrance模型实现glossy材质](https://zhuanlan.zhihu.com/p/160804623)
- 如题，其效果确实好，但有需要注意的地方，见后 TODO:加入超链接

## 一、 效果图
### 路径追踪，包括漫反射（左右墙壁）、理想反射（左边球）、理想折射（右边球）、抗锯齿

![路径追踪](./results/cornell_anti.bmp)
-
### glossy材质：一种哑光粗糙面

![glossy](./results/glossy.bmp)
-
### NEE:以更少的samplesPerPixel（spp，这个概念在后面讲到）获得更好的效果。第一张图为 NEE在20spp的结果，第二张图为 无NEE在20spp的结果

![Nee](./results/NEE_20.bmp)
![noNee](./results/noNEE_20.bmp)
-
### 景深：焦距处的物体清晰，其他地方的物体模糊
![Depth](./results/depth.bmp)
-
### 纹理贴图：就是把二维图片贴到三维物体上
![texture](./results/texture.bmp)
-
### 参数曲面求交：PA2中我们是用OPENGL自动算求交的（当然大作业肯定是不能用OPENGL），所以如果你发现自己的ray tracing或者path tracing跑PA2的测例是空的，就是因为你没有自己写求交。下面的图在与视线平齐的地方有瑕疵，但比学长的好。学长的半个花瓶都变成背面了
![curve](./results/china.bmp)
-
### 运动模糊
![move](./results/move.bmp)

## 二、 大作业要求
详见本仓库 “大作业要求.txt”
## 三. 对大作业的感受
### 3.1 对我实现的功能点的感受

由于本菜鸡并没有实现其他功能，所以对其他的难度并不知晓。

如果你照着smallpt（99行）写的基础的path tracing，那么已经有了cos-weighted采样、抗锯齿这两个加分项。如果你照着smallpt（二百多行）写的，那么应该有NEE了。

glossy材质**不要看ppt！！！不要看ppt！！！不要看ppt！！！**看ppt不如看我给你讲。

参数曲面求交，作为高加分项，难度确实大，而且直到ddl我都没有解决在与视线平齐的求交问题。不知道能拿几分。

景深较为简单，只需要改一个文件，写一个类即可。

运动模糊也较为简单。如果你只写球的运动模糊，只需要在大作业前的代码基础上加一行代码即可（前提是你已经有了

纹理贴图的代码量相比较于分值来说较大。如果只实现球的贴图、平面贴图的话难度不大。**注意：实现曲面贴图的前置条件是实现曲面求交**

cos-weighted采样，smallpt本身就用的这个方法，所以照着smallpt写自动获得这个加分项。**但是助教说：因为smallpt有，所以这个采样相较于其他的采样，分值会更低**

抗锯齿，smallpt本身就有抗锯齿，效果很好但是**需要更多渲染时间**

### 3.2 对实现先后的感受
虽然要求中建议你先实现whitted-style ray tracing，但是我建议直接写path tracing。

一方面，path tracing有现成的smallpt的代码，照抄再改改一定能出来，而whitted-style的代码少的可怜，至少我没找到很好的，不管是学长的还是其他的

另一方面，最后验收分数，如果你有path tracing的话，直接给到path tracing的分（包括了whitted-style），而whitted-style的给分只是在你没写path tracing的时候才细看的。

所以我也不讲whitted-style了，仓库里也没有。因为我的whitted-style可能遗留了未解决的问题。

## 四、具体功能实现讲解
### 4.1 path tracing